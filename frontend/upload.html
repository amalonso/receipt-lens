<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subir Factura - Receipt Lens</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <style>
        .upload-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .preview-container {
            margin-top: 2rem;
            display: none;
        }

        .preview-container.active {
            display: block;
        }

        .image-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .file-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            margin-top: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--bg-tertiary);
            border-radius: 9999px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            border-radius: 9999px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .analysis-result {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--border-radius);
            display: none;
        }

        .analysis-result.active {
            display: block;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .result-icon {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .result-title {
            flex: 1;
        }

        .result-title h3 {
            font-size: 1.75rem;
            margin-bottom: 0.25rem;
        }

        .result-title p {
            opacity: 0.9;
            margin-bottom: 0;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .result-stat {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .result-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .mode-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
        }

        .mode-switch-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: calc(var(--border-radius) - 4px);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .mode-switch-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .multiple-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .preview-item {
            position: relative;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            aspect-ratio: 1;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(220, 38, 38, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
        }

        .preview-item-number {
            position: absolute;
            bottom: 0.5rem;
            left: 0.5rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .add-more-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            aspect-ratio: 1;
            cursor: pointer;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
        }

        .add-more-btn:hover {
            border-color: var(--primary-color);
            background: var(--bg-tertiary);
        }

        .add-more-btn span {
            font-size: 2rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar (reuse from dashboard) -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/dashboard.html" class="sidebar-logo">
                    üßæ Receipt Lens
                </a>
            </div>

            <nav class="sidebar-nav">
                <a href="/dashboard.html" class="nav-item">
                    <span class="icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="/upload.html" class="nav-item active">
                    <span class="icon">üì§</span>
                    <span>Subir Factura</span>
                </a>
                <a href="/receipts.html" class="nav-item">
                    <span class="icon">üßæ</span>
                    <span>Mis Facturas</span>
                </a>
                <a href="/analytics.html" class="nav-item">
                    <span class="icon">üìà</span>
                    <span>Analytics</span>
                </a>
                <a href="/profile.html" class="nav-item">
                    <span class="icon">üë§</span>
                    <span>Perfil</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info" id="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-details">
                        <div class="user-name" id="user-name">Cargando...</div>
                        <div class="user-email" id="user-email"></div>
                    </div>
                </div>
                <button class="btn btn-danger btn-block btn-sm" onclick="handleLogout()">
                    Cerrar Sesi√≥n
                </button>
            </div>
        </aside>

        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="topbar">
                <div class="flex items-center gap-4">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h1>Subir Factura</h1>
                </div>
            </div>

            <div class="content-area">
                <!-- Breadcrumbs -->
                <nav class="breadcrumbs">
                    <div class="breadcrumb-item">
                        <a href="/dashboard.html">Inicio</a>
                    </div>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <div class="breadcrumb-item">
                        <span class="breadcrumb-current">Subir Factura</span>
                    </div>
                </nav>

                <!-- Mobile back button -->
                <a href="/dashboard.html" class="mobile-back-btn">
                    ‚Üê Volver al Dashboard
                </a>

                <div class="upload-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Analiza tu factura con IA</h3>
                            <p class="card-subtitle">Sube una foto de tu ticket y Claude AI extraer√° autom√°ticamente todos los datos</p>
                        </div>
                        <div class="card-body">
                            <!-- Mode Switch -->
                            <div class="mode-switch">
                                <button type="button" class="mode-switch-btn active" id="single-mode-btn" onclick="switchMode('single')">
                                    üìÑ Una imagen
                                </button>
                                <button type="button" class="mode-switch-btn" id="multiple-mode-btn" onclick="switchMode('multiple')">
                                    üìö M√∫ltiples im√°genes (ticket largo)
                                </button>
                            </div>

                            <!-- Dropzone (Single Mode) -->
                            <div class="dropzone" id="dropzone">
                                <div class="dropzone-icon">üì§</div>
                                <div class="dropzone-text">
                                    <p style="font-size: 1rem; margin-bottom: 0.5rem;"><strong id="dropzone-title">Arrastra tu factura aqu√≠</strong></p>
                                    <p style="margin-bottom: 0.5rem;">o</p>
                                    <button type="button" class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                                        Seleccionar Archivo<span id="file-btn-suffix"></span>
                                    </button>
                                    <p style="margin-top: 1rem; font-size: 0.75rem;" id="dropzone-info">Formatos soportados: JPG, PNG, PDF (m√°x. 10MB)</p>
                                </div>
                            </div>

                            <input type="file" id="file-input" accept="image/jpeg,image/png,application/pdf" style="display: none;">

                            <!-- Preview Container -->
                            <div class="preview-container" id="preview-container">
                                <h4>Vista Previa</h4>
                                <img id="image-preview" class="image-preview" alt="Preview">
                                <div class="file-info">
                                    <div>
                                        <strong id="file-name">archivo.jpg</strong>
                                        <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;" id="file-size">0 KB</p>
                                    </div>
                                    <button class="btn btn-danger btn-sm" onclick="clearFile()">
                                        ‚úï Eliminar
                                    </button>
                                </div>

                                <div class="progress-bar" id="progress-bar" style="display: none;">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>

                                <button class="btn btn-primary btn-lg btn-block mt-4" id="upload-btn" onclick="uploadFile()">
                                    üöÄ Analizar Factura
                                </button>
                            </div>

                            <!-- Multiple Images Preview Container -->
                            <div class="preview-container" id="multiple-preview-container" style="display: none;">
                                <h4>Im√°genes seleccionadas (<span id="image-count">0</span>)</h4>
                                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">
                                    Las im√°genes se unir√°n en el orden mostrado. Puedes subir hasta 10 im√°genes.
                                </p>
                                <div class="multiple-preview-grid" id="multiple-preview-grid">
                                    <!-- Preview items will be added here -->
                                </div>

                                <div class="progress-bar" id="progress-bar-multiple" style="display: none; margin-top: 1rem;">
                                    <div class="progress-fill" id="progress-fill-multiple"></div>
                                </div>

                                <button class="btn btn-primary btn-lg btn-block mt-4" id="upload-btn-multiple" onclick="uploadMultipleFiles()">
                                    üöÄ Unir y Analizar Factura
                                </button>
                            </div>

                            <!-- Analysis Result -->
                            <div class="analysis-result" id="analysis-result">
                                <div class="result-header">
                                    <div class="result-icon">‚úÖ</div>
                                    <div class="result-title">
                                        <h3>An√°lisis Completado</h3>
                                        <p>Tu factura ha sido procesada exitosamente</p>
                                    </div>
                                </div>

                                <div class="result-stats" id="result-stats">
                                    <div class="result-stat">
                                        <div class="result-stat-value">--</div>
                                        <div class="result-stat-label">Total</div>
                                    </div>
                                    <div class="result-stat">
                                        <div class="result-stat-value">--</div>
                                        <div class="result-stat-label">Items</div>
                                    </div>
                                    <div class="result-stat">
                                        <div class="result-stat-value">--</div>
                                        <div class="result-stat-label">Tienda</div>
                                    </div>
                                </div>

                                <div style="display: flex; gap: 1rem;">
                                    <a href="/receipts.html" class="btn btn-lg" style="flex: 1; background: white; color: var(--primary-color);">
                                        Ver Todas las Facturas
                                    </a>
                                    <button class="btn btn-lg" style="flex: 1; background: rgba(255,255,255,0.2); color: white;" onclick="uploadAnother()">
                                        Subir Otra
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tips Card -->
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">üí° Consejos para mejores resultados</h4>
                        </div>
                        <div class="card-body">
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 0.5rem 0; display: flex; gap: 0.75rem;">
                                    <span>‚úì</span>
                                    <span>Aseg√∫rate de que el texto sea legible y la imagen est√© bien iluminada</span>
                                </li>
                                <li style="padding: 0.5rem 0; display: flex; gap: 0.75rem;">
                                    <span>‚úì</span>
                                    <span>Evita sombras y reflejos en la factura</span>
                                </li>
                                <li style="padding: 0.5rem 0; display: flex; gap: 0.75rem;">
                                    <span>‚úì</span>
                                    <span>La factura debe estar completa y sin cortes</span>
                                </li>
                                <li style="padding: 0.5rem 0; display: flex; gap: 0.75rem;">
                                    <span>‚úì</span>
                                    <span>Formatos soportados: JPG, PNG, PDF (m√°x. 10MB)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/utils.js"></script>
    <script>
        // Check authentication
        requireAuth();

        let selectedFile = null;
        let selectedFiles = []; // For multiple mode
        let uploadMode = 'single'; // 'single' or 'multiple'

        // Load user info
        async function loadUserInfo() {
            try {
                const user = window.api.getCachedUser();
                if (user) {
                    updateUserDisplay(user);
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        function updateUserDisplay(user) {
            const avatar = user.username.charAt(0).toUpperCase();
            document.getElementById('user-avatar').textContent = avatar;
            document.getElementById('user-name').textContent = user.username;
            document.getElementById('user-email').textContent = user.email;
        }

        // Drag and drop handlers
        const dropzone = document.getElementById('dropzone');

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('drag-over');
        });

        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('drag-over');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('drag-over');

            const files = e.dataTransfer.files;
            if (uploadMode === 'single' && files.length > 0) {
                handleFileSelect(files[0]);
            } else if (uploadMode === 'multiple' && files.length > 0) {
                handleMultipleFileSelect(Array.from(files));
            }
        });

        // File input handler
        document.getElementById('file-input').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                if (uploadMode === 'single') {
                    handleFileSelect(e.target.files[0]);
                } else {
                    handleMultipleFileSelect(Array.from(e.target.files));
                }
            }
        });

        function handleFileSelect(file) {
            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                showToast('Tipo de archivo no soportado. Usa JPG, PNG o PDF', 'error');
                return;
            }

            // Validate file size (10MB)
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showToast('El archivo es demasiado grande. M√°ximo 10MB', 'error');
                return;
            }

            selectedFile = file;

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                if (file.type === 'application/pdf') {
                    document.getElementById('image-preview').style.display = 'none';
                } else {
                    document.getElementById('image-preview').src = e.target.result;
                    document.getElementById('image-preview').style.display = 'block';
                }

                document.getElementById('file-name').textContent = file.name;
                document.getElementById('file-size').textContent = formatFileSize(file.size);
                document.getElementById('preview-container').classList.add('active');
            };
            reader.readAsDataURL(file);
        }

        function clearFile() {
            selectedFile = null;
            document.getElementById('preview-container').classList.remove('active');
            document.getElementById('file-input').value = '';
            document.getElementById('analysis-result').classList.remove('active');
        }

        // Mode switching
        function switchMode(mode) {
            uploadMode = mode;

            // Update button states
            document.getElementById('single-mode-btn').classList.toggle('active', mode === 'single');
            document.getElementById('multiple-mode-btn').classList.toggle('active', mode === 'multiple');

            // Update dropzone text
            const fileInput = document.getElementById('file-input');
            if (mode === 'single') {
                document.getElementById('dropzone-title').textContent = 'Arrastra tu factura aqu√≠';
                document.getElementById('file-btn-suffix').textContent = '';
                document.getElementById('dropzone-info').textContent = 'Formatos soportados: JPG, PNG, PDF (m√°x. 10MB)';
                fileInput.removeAttribute('multiple');
                fileInput.accept = 'image/jpeg,image/png,application/pdf';
            } else {
                document.getElementById('dropzone-title').textContent = 'Arrastra tus im√°genes aqu√≠';
                document.getElementById('file-btn-suffix').textContent = 's';
                document.getElementById('dropzone-info').textContent = 'Selecciona m√∫ltiples fotos del mismo recibo (JPG, PNG - m√°x. 10 im√°genes)';
                fileInput.setAttribute('multiple', 'multiple');
                fileInput.accept = 'image/jpeg,image/png';
            }

            // Clear current selections
            clearFile();
            clearMultipleFiles();
        }

        // Multiple files handling
        function handleMultipleFileSelect(files) {
            const allowedTypes = ['image/jpeg', 'image/png'];
            const maxFiles = 10;

            // Filter valid files
            const validFiles = files.filter(file => {
                if (!allowedTypes.includes(file.type)) {
                    showToast(`${file.name}: Tipo no soportado. Solo JPG y PNG`, 'error');
                    return false;
                }
                const maxSize = 10 * 1024 * 1024;
                if (file.size > maxSize) {
                    showToast(`${file.name}: Archivo demasiado grande. M√°x 10MB`, 'error');
                    return false;
                }
                return true;
            });

            // Check total count
            if (selectedFiles.length + validFiles.length > maxFiles) {
                showToast(`M√°ximo ${maxFiles} im√°genes permitidas`, 'error');
                return;
            }

            // Add files to selection
            selectedFiles.push(...validFiles);
            updateMultiplePreview();
        }

        function updateMultiplePreview() {
            const grid = document.getElementById('multiple-preview-grid');
            grid.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <button class="preview-item-remove" onclick="removeFile(${index})" title="Eliminar">
                            ‚úï
                        </button>
                        <div class="preview-item-number">${index + 1}</div>
                    `;
                    grid.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            });

            // Add "add more" button if less than 10
            if (selectedFiles.length < 10) {
                const addMore = document.createElement('div');
                addMore.className = 'add-more-btn';
                addMore.onclick = () => document.getElementById('file-input').click();
                addMore.innerHTML = '<span>+</span>';
                grid.appendChild(addMore);
            }

            // Update count and show container
            document.getElementById('image-count').textContent = selectedFiles.length;
            if (selectedFiles.length > 0) {
                document.getElementById('multiple-preview-container').style.display = 'block';
            } else {
                document.getElementById('multiple-preview-container').style.display = 'none';
            }
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateMultiplePreview();
        }

        function clearMultipleFiles() {
            selectedFiles = [];
            document.getElementById('multiple-preview-container').style.display = 'none';
            document.getElementById('file-input').value = '';
            document.getElementById('analysis-result').classList.remove('active');
        }

        async function uploadMultipleFiles() {
            if (selectedFiles.length === 0) {
                showToast('Por favor selecciona al menos una imagen', 'error');
                return;
            }

            const uploadBtn = document.getElementById('upload-btn-multiple');
            const progressBar = document.getElementById('progress-bar-multiple');
            const progressFill = document.getElementById('progress-fill-multiple');

            // Disable button and show progress
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<div class="spinner spinner-sm"></div> Uniendo y analizando con IA...';
            progressBar.style.display = 'block';

            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 90) progress = 90;
                progressFill.style.width = `${progress}%`;
            }, 300);

            try {
                const response = await window.api.uploadMultipleReceipts(selectedFiles);

                // Complete progress
                clearInterval(progressInterval);
                progressFill.style.width = '100%';

                if (response.success) {
                    showToast(`${selectedFiles.length} im√°genes procesadas exitosamente`, 'success');

                    // Show result
                    const receipt = response.data.receipt;
                    document.getElementById('result-stats').innerHTML = `
                        <div class="result-stat">
                            <div class="result-stat-value">${formatCurrency(receipt.total_amount)}</div>
                            <div class="result-stat-label">Total</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${receipt.items_count || 0}</div>
                            <div class="result-stat-label">Items</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${receipt.store_name}</div>
                            <div class="result-stat-label">Tienda</div>
                        </div>
                    `;

                    document.getElementById('analysis-result').classList.add('active');

                    // Hide upload UI
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        uploadBtn.style.display = 'none';
                    }, 1000);
                } else {
                    throw new Error(response.error || 'Error al procesar las im√°genes');
                }
            } catch (error) {
                clearInterval(progressInterval);
                progressBar.style.display = 'none';
                showToast(error.message || 'Error al analizar las im√°genes', 'error');
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = 'üöÄ Unir y Analizar Factura';
            }
        }

        async function uploadFile() {
            if (!selectedFile) {
                showToast('Por favor selecciona un archivo', 'error');
                return;
            }

            const uploadBtn = document.getElementById('upload-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');

            // Disable button and show progress
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<div class="spinner spinner-sm"></div> Analizando con Claude AI...';
            progressBar.style.display = 'block';

            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressFill.style.width = `${progress}%`;
            }, 200);

            try {
                const response = await window.api.uploadReceipt(selectedFile);

                // Complete progress
                clearInterval(progressInterval);
                progressFill.style.width = '100%';

                if (response.success) {
                    showToast('Factura analizada exitosamente', 'success');

                    // Show result
                    const receipt = response.data.receipt;
                    document.getElementById('result-stats').innerHTML = `
                        <div class="result-stat">
                            <div class="result-stat-value">${formatCurrency(receipt.total_amount)}</div>
                            <div class="result-stat-label">Total</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${receipt.items_count || 0}</div>
                            <div class="result-stat-label">Items</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${receipt.store_name}</div>
                            <div class="result-stat-label">Tienda</div>
                        </div>
                    `;

                    document.getElementById('analysis-result').classList.add('active');

                    // Hide upload UI
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        uploadBtn.style.display = 'none';
                    }, 1000);
                } else {
                    throw new Error(response.error || 'Error al subir la factura');
                }
            } catch (error) {
                clearInterval(progressInterval);
                progressBar.style.display = 'none';
                showToast(error.message || 'Error al analizar la factura', 'error');
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = 'üöÄ Analizar Factura';
            }
        }

        function uploadAnother() {
            document.getElementById('analysis-result').classList.remove('active');
            document.getElementById('upload-btn').style.display = 'block';
            document.getElementById('upload-btn-multiple').style.display = 'block';
            clearFile();
            clearMultipleFiles();
        }

        function handleLogout() {
            if (confirm('¬øEst√°s seguro que quieres cerrar sesi√≥n?')) {
                window.api.logout();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        document.getElementById('sidebar-overlay').addEventListener('click', toggleSidebar);

        // Initialize
        loadUserInfo();
    </script>
</body>
</html>
